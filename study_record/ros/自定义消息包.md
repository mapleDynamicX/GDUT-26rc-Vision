# 自定义消息包

[2.1.4 话题通信自定义msg · Autolabor-ROS机器人入门课程《ROS理论与实践》零基础教程](http://www.autolabor.com.cn/book/ROSTutorials/di-2-zhang-ros-jia-gou-she-ji/22hua-ti-tong-xin/214-hua-ti-tong-xin-zhi-zi-ding-yi-xiao-xi.html)

在 ROS 1 的自定义消息中，`float`类型的数组**不需要指定固定长度**，默认定义的是动态数组（可以动态增减元素数量）。如果需要固定长度的数组，可以在定义时指定长度

### 1. 两种数组定义方式

在`.msg`文件中，数组有两种定义方式：

```xml
# 动态数组（无需指定长度，最常用）
float32[] data

# 固定长度数组（指定长度为10）
float32[10] data_fixed
```

## 示例

```cpp
#include <ros/ros.h>
#include "your_package_name/FloatArrayStamped.h"  // 替换为你的包名

int main(int argc, char**argv) {
    ros::init(argc, argv, "array_publisher");
    ros::NodeHandle nh;

    // 创建发布者，消息类型为自定义消息
    ros::Publisher pub = nh.advertise<your_package_name::FloatArrayStamped>("array_topic", 10);
    ros::Rate rate(10);  // 10Hz

    while (ros::ok()) {
        your_package_name::FloatArrayStamped msg;

        // 设置时间戳（来自Header）
        msg.header.stamp = ros::Time::now();
        msg.header.frame_id = "base_link";  // 可选，指定坐标系

        // 给动态数组添加元素
        msg.data_dynamic.push_back(1.1);
        msg.data_dynamic.push_back(2.2);
        msg.data_dynamic.push_back(3.3);

        // 给固定长度数组赋值（必须填满指定长度）
        for (int i = 0; i < 5; i++) {
            msg.data_fixed[i] = i * 0.5;
        }

        pub.publish(msg);
        rate.sleep();
    }
    return 0;
}
```

## 其他包要调用

##### 步骤 4：其他包使用该消息

- 在目标包的 `package.xml` 中添加对源包的依赖：

```xml
<depend>my_msg_package</depend>  <!-- 依赖自定义消息包 -->
```

在目标包的 `CMakeLists.txt` 中声明依赖：

```xml
find_package(catkin REQUIRED COMPONENTS
  roscpp
  my_msg_package  # 引入自定义消息包
)
blish(msg);
        rate.sleep();
    }
    return 0;
}
 其他包要调用 
 步骤 4：其他包使用该消息
在目标包的 package.xml 中添加对源包的依赖：

<depend>my_msg_package</depend>  <!-- 依赖自定义消息包 -->

在目标包的 CMakeLists.txt 中声明依赖：

find_package(catkin REQUIRED COMPONENTS
  roscpp
  my_msg_package  # 引入自定义消息包
)
```


















































