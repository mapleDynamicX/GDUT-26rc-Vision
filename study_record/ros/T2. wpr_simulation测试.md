move_base原理见4.
总结一共要三个节点： move_base导航节点, map_server地图节点, amcl定位节点

##### 1. 编译wpr_simulation和wpr_home两个包

```bash
cd wpr_ws/src/wpr_simulation-master/scripts
./install_for_noetic.sh
cd ..
cd ..
cd ..
catkin_make
```

构建好后， 下载

https://github.com/6-robot/wpb_home

```bash
cd src
cd wpb_home-master/
cd wpb_home_bringup/
cd scripts/
./install_for_noetic.sh 
cd ~/wpr_ws/
catkin_make
```

##### 2. 复制导航要用到的全局地图

到/wpr_ws/src/wpr_simulation-master/maps下

![](/home/h/snap/marktext/9/.config/marktext/images/2025-09-03-16-49-33-2025-09-03%2016-49-14%20的屏幕截图.png)

##### 3. 编写launch文件包

前期的编译工作完成后， 需要编写launch文件包；来启动这是三个节点

```bash
cd ~/wpr_ws/src/
catkin_create_pkg nav_pkg roscpp rospy move_base_msgs actionlib
cd nav_pkg
mkdir -p launch
```

接下来进入vscode打开刚才的nav_pkg

###### 3.1 进入launch文件夹中新建一个nav.launch文件

![](/home/h/snap/marktext/9/.config/marktext/images/2025-09-03-17-04-26-2025-09-03%2017-04-11%20的屏幕截图.png)

###### 3.2 复制这里面的参数

![](/home/h/snap/marktext/9/.config/marktext/images/2025-09-03-17-09-56-2025-09-03%2017-08-01%20的屏幕截图.png)

```launch
<launch>
    <node pkg="move_base" type="move_base" name="move_base">
        <rosparam file="$(find wpb_home_tutorials)/nav_lidar/costmap_common_params.yaml" command="load" ns="global_costmap" />
        <rosparam file="$(find wpb_home_tutorials)/nav_lidar/costmap_common_params.yaml" command="load" ns="local_costmap" />
        <rosparam file="$(find wpb_home_tutorials)/nav_lidar/global_costmap_params.yaml" command="load" />
        <rosparam file="$(find wpb_home_tutorials)/nav_lidar/local_costmap_params.yaml" command="load" />
        <param name="base_global_planner" value="global_planner/GlobalPlanner" /> 
        <param name="base_local_planner" value="wpbh_local_planner/WpbhLocalPlanner" />
    </node>

    <node pkg="map_server" type="map_server" name="map_server" args="$(find wpr_simulation)/maps/map.yaml"/>
    <node pkg="amcl" type="amcl" name="amcl"/>
</launch>
```

###### 3.3 最后回到终端编译nav_pkg

```bash
cd ~/wpr_ws/
catkin_make
```

###### 3.4 刷新环境

```bash
cd ~/wpr_ws/
source devel/setup.bash
```

###### 3.5 添加环境变量， 在系统的bashrc文件中添加

```
source /home/h/wpr_ws/devel/setup.bash
```

###### 3.6 检查是否能找到包

```bash
rospack find wpr_simulation 
```

<u>实在找不到，回到wpr_ws的终端source下， 在这个终端中启动下面的roslaunch</u>

##### 4. 同时运行launch文件和仿真环境即可

###### 4.1 第一个终端：

```bash
roscore
```

###### 4.2 第二个终端：（找不到source下）

```bash
roslaunch wpr_simulation wpb_stage_robocup.launch 
```

###### 4.3 效果如下

![](/home/h/snap/marktext/9/.config/marktext/images/2025-09-03-17-57-50-2025-09-03%2017-57-17%20的屏幕截图.png)

###### 4.4 第三个终端：运行刚才编写的launch文件, 启动关键的三个节点

注： 这里如果输入包名称和节点名称时不能tab, 这样source下就行了

![](/home/h/snap/marktext/9/.config/marktext/images/2025-09-03-18-08-56-2025-09-03%2018-00-29%20的屏幕截图.png)

```bash
roslaunch nav_pkg nav.launch
```

###### 4.5 第四个终端：启动rviz 给目标点（也要source下）

```bash
rviz
```

左下角添加map, 选好topic（一般为/map，选好后会显示出之前指定的地图）

左下角添加RobotModel， 

![](/home/h/snap/marktext/9/.config/marktext/images/2025-09-03-18-40-34-2025-09-03%2018-21-24%20的屏幕截图.png)

---

###### 4.6 出现的相关问题

问题一： rviz中不能正确加载机器人的模型，但是gazebo中可以

问题二： 启动自己写的launch文件有警示

问题三： rviz中订阅的map话题与实际预先选择的地图一致， 但gazebo中不一致（原因： rviz是选择自己的地图，**没有使用之前教程说的按步骤保存的地图**）

##### 5. 问题解决

###### 5.1 先建好图

终端一： 

```bash
roscore
```

终端二：

```bash
cd wpr_ws/
source devel/setup.bash
roslaunch wpr_simulation wpb_gmapping.launch 
```

终端三：

```bash
cd wpr_ws/
source devel/setup.bash
rosrun wpr_simulation keyboard_vel_ctrl 
```

![](/home/h/snap/marktext/9/.config/marktext/images/2025-09-03-19-09-25-2025-09-03%2019-09-06%20的屏幕截图.png)

在这个终端中输入wasd可以发现rviz中的机器人正在移动

移动好覆盖全图后，保存地图

终端四：

```bash
rosrun map_server map_server -f map
```

保存完后，将地图放到之前要求的目录下， 然后修改launch文件， 再重新配置这个工作空间

再跑这个4. 即可解决问题三

###### 5.2 rviz中无法加载机器人模型

![](/home/h/snap/marktext/9/.config/marktext/images/2025-09-04-18-17-09-2025-09-04%2018-13-27%20的屏幕截图.png)

该包未被 ROS 识别，需检查包是否存在于工作空间

启动rviz的终端也要：

```bash
cd wpr_ws/
source devel/setup.bash
rviz
```

**在左下角添加机器人模型: RobotModel和机器人运动路径： Path**

注意这里的path要订阅话题才能显示路径: /move_base/GlobalPlanner/plan

###### 5.3 解决每次都要source的问题

---  

测试成功，至此本篇结束

## 保存地图

```bash
rosrun map_server map_saver -f map
rosrun map_server map_saver _map_topic:=<你的地图话题名称> -f <保存路径>
```
