# 卡尔曼滤波

### 卡尔曼滤波详解（双输入双输出场景）

卡尔曼滤波（Kalman Filter）是一种针对线性高斯系统的最优递归状态估计算法，通过动态平衡​**​预测模型​**​与​**​测量数据​**​，在噪声干扰下实现高精度状态估计。以下针对​**​双输入（控制输入+测量输入）​**​和​**​双输出（状态估计+协方差估计）​**​的场景进行详细解析。

---

#### 一、核心公式与参数定义

卡尔曼滤波分为​**​预测​**​和​**​更新​**​两阶段，其数学框架如下：

##### 1. ​**​系统模型​**​

- ​**​状态方程​**​（预测阶段）：
  
  xk−​=Fxk−1​+Buk​+wk​
  
  - xk−​: 预测状态（2维向量，如位置+速度）
  
  - F: 状态转移矩阵（2×2）
  
  - B: 控制输入矩阵（2×1）
  
  - uk​: 控制输入（如加速度，1维）
  
  - wk​: 过程噪声（2维，均值为0，协方差矩阵Q）

- ​**​观测方程​**​（更新阶段）：
  
  zk​=Hxk​+vk​
  
  - zk​: 测量值（如位置，1维）
  
  - H: 观测矩阵（1×2）
  
  - vk​: 测量噪声（1维，均值为0，协方差R）

##### 2. ​**​关键参数​**​

| 参数  | 维度  | 物理意义    | 典型取值           |
| --- | --- | ------- | -------------- |
| Q   | 2×2 | 过程噪声协方差 | diag(0.1,0.01) |
| R   | 1×1 | 测量噪声协方差 | 0.52           |
| P   | 2×2 | 估计误差协方差 | 初始值I           |

---

#### 二、双输入双输出实现流程

假设场景为​**​无人机姿态估计​**​，输入为陀螺仪角速度（控制输入）和视觉里程计位置（测量输入），输出为姿态角（状态）及其协方差。

##### 1. ​**​预测阶段​**​

- ​**​状态预测​**​：
  
  x^k−​=Fx^k−1​+Buk​
  
  - 例如：F=[10​Δt1​]（匀速运动模型）

- ​**​协方差预测​**​：
  
  Pk−​=FPk−1​F⊤+Q
  
  - Q反映模型不确定性（如陀螺仪漂移）

##### 2. ​**​更新阶段​**​

- ​**​卡尔曼增益​**​：
  
  Kk​=Pk−​H⊤(HPk−​H⊤+R)−1
  
  - H=[1​0​]（仅观测位置）

- ​**​状态修正​**​：
  
  x^k​=x^k−​+Kk​(zk​−Hx^k−​)
  
  - 若视觉测量噪声小（R小），增益Kk​趋近1，信任测量值

- ​**​协方差修正​**​：
  
  Pk​=(I−Kk​H)Pk−​

---

#### 三、参数调优与代码实现

##### 1. ​**​参数调优策略​**​

- ​**​过程噪声Q​**​：通过系统动态特性设定。例如：
  
  - 陀螺仪噪声大 → 增大Q22​（角速度噪声）

- ​**​测量噪声R​**​：基于传感器精度设定。例如：
  
  - 视觉里程计误差标准差为0.1m → R=0.12

![](/home/maple/笔记/images/2025-08-04-16-06-13-卡尔曼滤波.png)

[卡尔曼滤波算法公式详解及应用（内附完整C代码及注释）-CSDN博客](https://blog.csdn.net/DearJULY/article/details/148240007?ops_request_misc=%257B%2522request%255Fid%2522%253A%25222b1755028437d59bd7867643a4ef859a%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=2b1755028437d59bd7867643a4ef859a&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-148240007-null-null.142^v102^pc_search_result_base5&utm_term=%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E7%AE%97%E6%B3%95&spm=1018.2226.3001.4187)

### **二、让卡尔曼滤波更相信测量值的关键参数调整方法​**​

要增大 Kk​，需从 Pk−​、Rk​和 Hk​三个参数入手，具体方法如下：

#### ​**​1. 减小观测噪声协方差 Rk​​**​

Rk​是观测噪声的协方差矩阵，直接反映观测数据的可靠性。Rk​越小，说明观测噪声越弱，滤波器越信任测量值。

​**​原理​**​：

Sk​=Hk​Pk−​HkT​+Rk​，当 Rk​减小时，Sk​减小，导致 Kk​=Pk−​HkT​Sk−1​增大（分母变小，分子不变时，整体增大）。

​**​操作示例​**​：

若传感器测量位置的标准差为 σz​，则 Rk​=σz2​。若实际噪声比标称值小（如 σz​=0.5m而非标称的1 m），则可将 Rk​设为 0.25（而非1），从而增大 Kk​，使滤波器更信任测量值。

#### ​**​2. 增大过程噪声协方差 Qk​​**​

Qk​是过程噪声的协方差矩阵，反映模型预测的不确定性。Qk​越大，模型预测的不确定性越高，滤波器会降低对预测值的信任，转而依赖观测值。

​**​原理​**​：

预测协方差 Pk−​=Fk​Pk−1​FkT​+Qk​。当 Qk​增大时，Pk−​增大，导致 Kk​增大（分子 Pk−​HkT​增大，若 Sk​增幅小于分子增幅，则 Kk​增大）。

​**​操作示例​**​：

在一维匀速运动模型中，过程噪声协方差 Qk​=[4Δt4​2Δt3​​2Δt3​Δt2​]q（q为加速度噪声方差）。若实际加速度噪声比模型假设的大（如 q=0.5m2/s3而非0.1），则增大 q会直接增大 Qk​，从而增大 Pk−​和 Kk​，使滤波器更信任测量值。

#### ​**​3. 调整初始协方差 P0​​**​

初始协方差 P0​反映初始状态估计的不确定性。P0​越大，初始阶段模型预测的不确定性越高，滤波器会更依赖测量值修正。

​**​原理​**​：

初始时刻 k=0，预测协方差 P0−​=P0​（无先验预测）。若 P0​较大，则初始卡尔曼增益 K0​较大，观测值对初始状态估计的修正权重更高。随着迭代，Pk​会逐渐收敛，但初始阶段的高 P0​可确保早期更信任测量值。

​**​操作示例​**​：

若初始位置估计误差为 ±5m（而非标称的 ±2m），则 P0​的位置对角线元素应设为 52=25（而非4），从而增大初始 P0​，使滤波器更依赖测量值。

#### ​**​4. 修改观测矩阵 Hk​（可选）​**​

Hk​决定了状态变量对观测值的贡献权重。若观测矩阵的某行对应测量值的分量较大，可间接增大该测量值的影响力。

​**​原理​**​：

Hk​的行对应观测值的线性组合系数。例如，若观测值为位置的线性组合 zk​=apk​+bvk​+vk​（a,b为系数），则 Hk​=[a,b]。增大 a会提高位置对观测值的贡献，间接使滤波器更关注位置测量值。

​**​注意​**​：Hk​通常由传感器特性决定（如GPS直接测量位置时 Hk​=[1,0]），实际中一般不调整，除非传感器模型需要重新建模。
