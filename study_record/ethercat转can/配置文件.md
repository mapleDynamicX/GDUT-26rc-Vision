# 配置文件.md

## kobe_ecat_hw.yaml

```yaml
 # 配置文件路径列表，指定系统所需的其他配置文件的相对路径，供程序加载额外参数
ConfigPath:
  # 执行器系数配置文件路径，存储电机控制相关的系数参数（如PID参数、电流-扭矩转换系数等）
  - ActuatorsConfig: "actuator_coeff.yaml"
  # EtherCAT通信配置文件路径，存储EtherCAT总线的通信参数（如通信周期、主从站配置等）
  - EcatConfig: "ecat/kobe_ecat_config.yaml"
  # EtherCAT从站硬件配置文件路径，存储从站设备的硬件特性参数（如设备类型、通信接口定义等）
  - EcatSlaveHWConfig: "ecat_hw/ecat_hw.yaml"

# 执行器（电机）配置列表，定义机器人所有电机的基本信息
Actuators:
  # 左前轮关节电机配置
  - name: "left_front_wheel_joint"  # 电机对应的关节名称，需与URDF模型中的关节名一致，用于运动控制映射
    type: "m3508"  # 电机型号（3508系列电机，常用于中小型机器人驱动）
    id: 0  # 电机在CAN总线上的唯一标识ID，用于CAN通信时指定目标设备
    canbus: CAN0  # 电机连接的CAN总线接口名称，指定通信总线
    reducer: 19.203208556  # 减速器减速比，用于将电机输出转速/扭矩转换为关节实际转速/扭矩（关节值=电机值/减速比）

  # 左后轮关节电机配置
  - name: "left_back_wheel_joint"  # 左后轮关节名称
    type: "m3508"  # 电机型号
    id: 1  # CAN总线ID（与其他电机不重复）
    canbus: CAN0  # 连接的CAN总线
    reducer: 19.203208556  # 减速比

  # 右后轮关节电机配置
  - name: "right_back_wheel_joint"  # 右后轮关节名称
    type: "m3508"  # 电机型号
    id: 2  # CAN总线ID
    canbus: CAN0  # 连接的CAN总线
    reducer: 19.203208556  # 减速比

  # 右前轮关节电机配置
  - name: "right_front_wheel_joint"  # 右前轮关节名称
    type: "m3508"  # 电机型号
    id: 3  # CAN总线ID
    canbus: CAN0  # 连接的CAN总线
    reducer: 19.203208556  # 减速比

# GPIO（通用输入输出）设备配置列表，定义板载GPIO接口的硬件特性
Gpio:
  # 第一个LED灯配置（注释说明：板上LED为低电平点亮，故初始值设为0）
  - name: "led1"  # LED设备名称，用于程序中标识该LED
    type: "output"  # 设备类型为输出（用于控制外部设备，如LED亮灭）
    id: 0  # GPIO接口的硬件编号，对应物理引脚
    initial_value: 0  # 初始电平值（0为低电平，使LED初始状态为点亮）

  # 第二个LED灯配置
  - name: "led2"  # 第二个LED名称
    type: "output"  # 输出类型
    id: 1  # GPIO硬件编号
    initial_value: 0  # 初始低电平（点亮）

  # 第一个按键开关配置（注释说明：板上按键按下时为低电平，故初始值设为1）
  - name: "switch1"  # 按键名称
    type: "input"  # 设备类型为输入（用于读取外部信号，如按键状态）
    id: 0  # GPIO硬件编号
    initial_value: 1  # 初始电平值（1为高电平，对应按键未按下状态）

  # 第二个按键开关配置
  - name: "switch2"  # 第二个按键名称
    type: "input"  # 输入类型
    id: 1  # GPIO硬件编号
    initial_value: 1  # 初始高电平（未按下状态）

# 注释掉的Ops9设备配置（可能为某种外部执行器或传感器）
# Ops9:
#   - name: "action1"  # 设备名称
#     serial_port: "/dev/ttyACM1"  # 连接的串口设备路径，用于串口通信

# 注释掉的串口转32位设备配置（可能为上层控制板的串口通信配置）
# 如果启用该配置，需在启动节点前将参数导入ROS参数服务器
# Serial_To_32:
#   name: "upper_board"  # 设备名称（如上层控制板）
```

## kobe_joint_limits.yaml

```yaml
# 关节限制配置的根节点，包含所有需要设置运动安全阈值的关节列表
# 核心作用：定义各关节的位置、速度、加速度、力矩等安全限制，防止硬件因超限运行损坏
joint_limits:
  # 左前轮关节的限制配置（对应Actuators中"left_front_wheel_joint"，确保关节名一致）
  left_front_wheel_joint: 
    # 布尔值，是否启用关节位置限制（true=启用，false=禁用）
    # 此处设为false：因车轮是连续旋转关节（无固定角度范围），无需限制位置
    has_position_limits: false
    # 关节最小位置限制，单位：弧度（rad）
    # 因has_position_limits=false，此值（-1e9，约-57.3亿度）仅为占位，实际不生效
    min_position: -1e9      # -170 degrees in radians 单位：弧度
    # 关节最大位置限制，单位：弧度（rad）
    # 同理，因位置限制禁用，此值（1e9，约57.3亿度）实际不生效
    max_position:  1e9      # +170 degrees

    # 布尔值，是否启用关节速度限制（true=启用，false=禁用）
    # 此处设为true：车轮转速需控制在安全范围，防止电机过载或车身失控
    has_velocity_limits: true
    # 关节最大角速度，单位：弧度/秒（rad/s）
    # 50.0 rad/s 约等于 180 度/秒（弧度与角度换算：1 rad ≈ 57.3°），是车轮允许的最高转速
    max_velocity:  50.00      # \~180 deg/s 单位：弧度/秒 # 最大角速度 (rad/s)

    # 布尔值，是否启用关节加速度限制（true=启用，false=禁用）
    # 此处设为false：当前场景无需限制加速度（或由其他模块控制），避免运动过缓
    has_acceleration_limits: false 
    # 关节最大角加速度，单位：弧度/秒²（rad/s²）
    # 因加速度限制禁用，此值（1e9 rad/s²，约57.3亿度/秒²）仅为占位，实际不生效
    max_acceleration:  1e9   # \~900 deg/s² 单位：弧度/秒²# 最大角加速度 (rad/s²)

    # 布尔值，是否启用关节力矩（力）限制（true=启用，false=禁用）
    # 此处设为true：需限制电机输出扭矩，防止齿轮、轴等机械结构因过载损坏
    has_effort_limits: true   
    # 关节最大允许力矩，单位：牛·米（N·m）
    # 5.0 N·m 是左前轮电机/减速器能承受的最大扭矩，超过会触发保护
    max_effort:  5.0          # Nm # 最大力矩 (N·m)

    # 布尔值，是否启用关节加加速度（Jerk）限制（true=启用，false=禁用）
    # Jerk是加速度的变化率，控制运动冲击；此处设为false（默认禁用），当前无需限制
    has_jerk_limits: false     # Disabled by default

    # 布尔值，是否启用关节角度环绕（仅连续旋转关节可用）
    # 此处设为true：车轮为连续旋转关节（如从 2π rad 旋转到 0 rad 无需反向绕圈），避免运动规划出错
    angle_wraparound: true   # For continuous joints only

  # 右前轮关节的限制配置（结构与左前轮一致，适配右前轮运动特性）
  right_front_wheel_joint:
      # 是否启用位置限制：禁用（右前轮为连续旋转关节）
      has_position_limits: false
      # 最小位置（占位，不生效）
      min_position: -1e9      # -170 degrees in radians 单位：弧度
      # 最大位置（占位，不生效）
      max_position:  1e9      # +170 degrees

      # 是否启用速度限制：启用（控制右前轮最高转速）
      has_velocity_limits: true
      # 最大角速度：50.45 rad/s（约180度/秒，与左前轮接近，保证车身两侧转速同步）
      max_velocity:  50.45      # \~180 deg/s 单位：弧度/秒

      # 是否启用加速度限制：禁用
      has_acceleration_limits: false 
      # 最大加速度（占位，不生效）
      max_acceleration:  1e9   # \~900 deg/s² 单位：弧度/秒²

      # 是否启用力矩限制：启用（保护右前轮机械结构）
      has_effort_limits: true   
      # 最大力矩：500.0 N·m（注意：与左前轮5.0 N·m差异较大，可能是配置笔误或硬件参数不同）
      max_effort:  500.0          # Nm 

      # 是否启用加加速度限制：禁用（默认）
      has_jerk_limits: false     # Disabled by default

      # 是否启用角度环绕：启用（右前轮为连续旋转关节）
      angle_wraparound: true   # For continuous joints only

  # 右后轮关节的限制配置（结构与前轮一致，适配右后轮运动特性）
  right_back_wheel_joint:
      # 是否启用位置限制：禁用（右后轮为连续旋转关节）
      has_position_limits: false
      # 最小位置（占位，不生效）
      min_position: -1e9      # -170 degrees in radians 单位：弧度
      # 最大位置（占位，不生效）
      max_position:  1e9      # +170 degrees

      # 是否启用速度限制：启用（控制右后轮最高转速）
      has_velocity_limits: true
      # 最大角速度：50.45 rad/s（与右前轮一致，保证前后轮转速协调）
      max_velocity:  50.45      # \~180 deg/s 单位：弧度/秒

      # 是否启用加速度限制：禁用
      has_acceleration_limits: false 
      # 最大加速度（占位，不生效）
      max_acceleration:  1e9   # \~900 deg/s² 单位：弧度/秒²

      # 是否启用力矩限制：启用（保护右后轮机械结构）
      has_effort_limits: true   
      # 最大力矩：500.0 N·m（与右前轮一致，统一后轮力矩标准）
      max_effort:  500.0          # Nm 

      # 是否启用加加速度限制：禁用（默认）
      has_jerk_limits: false     # Disabled by default

      # 是否启用角度环绕：启用（右后轮为连续旋转关节）
      angle_wraparound: true   # For continuous joints only   

  # 左后轮关节的限制配置（结构与其他车轮一致，适配左后轮运动特性）
  left_back_wheel_joint:
      # 是否启用位置限制：禁用（左后轮为连续旋转关节）
      has_position_limits: false
      # 最小位置（占位，不生效）
      min_position: -1e9      # -170 degrees in radians 单位：弧度
      # 最大位置（占位，不生效）
      max_position:  1e9      # +170 degrees

      # 是否启用速度限制：启用（控制左后轮最高转速）
      has_velocity_limits: true
      # 最大角速度：50.45 rad/s（与其他后轮一致，保证车身整体运动平稳）
      max_velocity:  50.45      # \~180 deg/s 单位：弧度/秒

      # 是否启用加速度限制：禁用
      has_acceleration_limits: false 
      # 最大加速度（占位，不生效）
      max_acceleration:  1e9   # \~900 deg/s² 单位：弧度/秒²

      # 是否启用力矩限制：启用（保护左后轮机械结构）
      has_effort_limits: true   
      # 最大力矩：500.0 N·m（与其他后轮一致，统一力矩标准）
      max_effort:  500.0          # Nm 

      # 是否启用加加速度限制：禁用（默认）
      has_jerk_limits: false     # Disabled by default

      # 是否启用角度环绕：启用（左后轮为连续旋转关节）
      angle_wraparound: true   # For continuous joints only
```

## kobe.urdf.xacro

```xml
<?xml version="1.0"?>
<!-- 注释：该Xacro文件仅用于ros-control（ROS控制框架）配置，不包含Gazebo仿真相关内容 -->
<!-- robot标签：Xacro文件的根标签，定义机器人模型的基础信息 -->
<!-- xmlns:xacro="http://www.ros.org/wiki/xacro"：声明Xacro命名空间，使文件支持Xacro语法（如参数、条件判断等） -->
<!-- name="hero"：机器人模型的名称，在ROS中用于标识该机器人模型 -->
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="hero">

    <!-- xacro:arg标签：定义一个可外部传入的参数，用于控制模型加载逻辑 -->
    <!-- name="load_chassis"：参数名称，标识是否加载底盘模型 -->
    <!-- default="true"：参数默认值为true，表示默认加载底盘模型 -->
    <xacro:arg name="load_chassis" default="true"/>

    <!-- 定义第二个参数，用于区分仿真环境与真实环境 -->
    <!-- name="use_simulation"：参数名称，标识是否使用仿真模式 -->
    <!-- default="true"：默认值为true，表示默认启用仿真模式（可能影响后续模型细节，如是否添加仿真专用传感器等） -->
    <xacro:arg name="use_simulation" default="true"/>

    <!-- 定义第三个参数，用于指定滚轮类型 -->
    <!-- name="roller_type"：参数名称，标识滚轮的类型（如仿真用简化模型或真实物理特性模型） -->
    <!-- default="realistic"：默认值为"realistic"，表示默认使用接近真实物理特性的滚轮模型 -->
    <xacro:arg name="roller_type" default="realistic"/>

    <!-- xacro:if标签：条件判断语句，根据参数值决定是否执行内部内容 -->
    <!-- value="$(arg load_chassis)"：判断条件，当load_chassis参数为true时，执行内部代码 -->
    <xacro:if value="$(arg load_chassis)">
        <!-- xacro:include标签：引入外部Xacro文件，实现模型模块化复用 -->
        <!-- filename="$(find joint_description)/urdf/kobe/chassis.urdf.xacro"：指定要引入的底盘模型Xacro文件路径 -->
        <!-- $(find joint_description)：通过ROS功能包查找机制，定位joint_description功能包的路径 -->
        <xacro:include filename="$(find joint_description)/urdf/kobe/chassis.urdf.xacro"/>

        <!-- 调用引入文件中定义的"chassis"宏（Xacro中的宏类似函数，用于生成重复或可配置的模型片段） -->
        <!-- roller_type="$(arg roller_type)"：向chassis宏传递参数，指定滚轮类型为前面定义的roller_type参数值 -->
        <xacro:chassis roller_type="$(arg roller_type)"/>
    </xacro:if>

</robot>
```

## chassis.urdf.xacro

```xml
<!-- 机器人模型的根标签，声明使用Xacro命名空间（http://www.ros.org/wiki/xacro），
     支持Xacro特有的语法（如参数、宏、条件判断），实现模型模块化与参数化 -->
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- 引入外部全向轮（omni_wheel）的Xacro模型文件，
       作用：复用全向轮的标准化模型定义（避免重复编写轮子的连杆、关节、惯性等代码），
       路径通过$(find joint_description)定位到joint_description功能包下的urdf/kobe目录 -->
  <xacro:include filename="$(find joint_description)/urdf/kobe/omni_wheel.urdf.xacro"/>

  <!-- 注释：参考维基百科底盘尺寸示意图，定义底盘相关的参数（Xacro属性，可全局复用） -->
  <!-- Xacro属性：底盘半径（从base_link原点到轮子中心的距离，即底盘对角线的一半），
       后续用于计算四个全向轮的x/y轴位置 -->
  <xacro:property name="chassis_radius" value="0.196"/>
  <!-- Xacro属性：轮子在z轴方向相对于base_link的偏移量，
       负号表示轮子位于base_link（底盘中心）的下方（接触地面），单位为米 -->
  <xacro:property name="wheel_offset_z" value="-0.04373"/>

  <!-- 定义底盘模型的Xacro宏（类似“函数”，可重复调用），
       name="chassis"：宏的名称，后续通过<xacro:chassis/>调用；
       params="roller_type"：宏的输入参数，用于传递滚轮类型（如“realistic”真实型，与之前配置呼应） -->
  <xacro:macro name="chassis" params="roller_type">

      <!-- 定义机器人的基础连杆（base_link），是所有其他连杆的“父连杆”，
           机器人坐标系的原点默认与base_link的原点重合 -->
      <link name="base_link">
          <!-- inertial：连杆的惯性参数，用于ROS运动学/动力学计算（如速度控制、力矩计算） -->
          <inertial>
              <mass value="12.326"/> <!-- 基础连杆的质量，单位：千克（kg） -->
              <origin xyz="-0.000932  -0.000668  -0.01"/> <!-- 惯性坐标系相对于base_link原点的偏移（x,y,z），
                                                               因制造误差或重心偏移，惯性中心可能不与几何中心重合 -->
              <inertia ixx="1.924e-1" ixy="-6.458e-4" ixz="5.951352e-3" iyy="2.473e-1"
                       iyz="-7.22e-4" izz="3.187e-1"/> <!-- 转动惯量矩阵，描述物体抵抗绕各轴转动的能力，
                                                         是动力学控制（如PID扭矩控制）的核心参数，
                                                         ixx/iyy/izz分别为绕x/y/z轴的转动惯量，
                                                         ixy/ixz/iyz为惯性积（描述轴间耦合） -->
          </inertial>

          <!-- visual：连杆的视觉模型，仅用于可视化显示（如RViz中看到的机器人外观），不影响物理计算 -->
          <visual>
              <origin xyz="0 0 0" rpy="0 0 0"/> <!-- 视觉模型相对于base_link原点的位姿（无偏移、无旋转） -->
              <geometry>
                  <!-- 引入外部STL三维模型文件（底盘的真实外观），
                       package://rm_description：ROS功能包路径，指向rm_description包下的meshes文件夹；
                       scale="0.001"：STL文件通常以毫米（mm）为单位，此处缩放到米（m）单位 -->
                  <mesh filename="package://rm_description/meshes/standard/base.stl" scale="0.001 0.001 0.001"/>
              </geometry>
          </visual>

          <!-- collision：连杆的碰撞模型，用于碰撞检测（如导航时避开障碍物、机械臂避障），
               通常用简单几何形状（如box）简化，避免复杂STL模型导致计算卡顿 -->
          <collision>
              <origin xyz="0 0 0" rpy="0 0 0"/> <!-- 碰撞模型相对于base_link原点的位姿（无偏移） -->
              <geometry>
                  <!-- 用长方体（box）近似底盘碰撞形状，size="x y z"：长方体的长、宽、高（单位：米），
                       x/y=0.392（对应底盘直径，因chassis_radius=0.196，直径=2*0.196=0.392），
                       z=0.2（底盘厚度） -->
                  <box size="0.392 0.392 0.2"/>
              </geometry>
          </collision>
      </link>

      <!-- 调用全向轮宏（<xacro:omni_wheel/>），生成左前轮模型，参数分别对应：
           prefix="left_front"：给轮子的关节/连杆名称加前缀（如left_front_wheel_joint），避免多轮子名称重复；
           connected_to="base_link"：轮子的父连杆（与base_link连接）；
           wheel_x_offset/wheel_y_offset：轮子在x/y轴相对于base_link的位置，
               chassis_radius/sqrt(2)：因底盘为正方形，四个轮子在正方形四角，x/y偏移等于“底盘半径（对角线半长）/√2”，
               即正方形边长的一半（正方形对角线=边长*√2，边长=对角线/√2=2*radius/√2=radius*√2？此处应为对角线半长（radius）除以√2，得到边长半长）；
           wheel_z_offset：轮子在z轴的位置（复用之前定义的Xacro属性，轮子在base_link下方）；
           rotation_degree="${3*pi/4}"：轮子的旋转角度（单位：弧度），3π/4=135°，
               全向轮需按特定角度布置（如左前轮135°、右前轮45°），才能实现全向移动（前后、左右、旋转）；
           roller_type="${roller_type}"：传递滚轮类型参数（从chassis宏输入）；
           max_effort="5"：轮子关节的最大允许力矩（与joint_limits中左前轮max_effort一致，保护硬件）；
           max_velocity="50"：轮子关节的最大允许角速度（与joint_limits中max_velocity一致，限制转速） -->
      <xacro:omni_wheel prefix="left_front" connected_to="base_link"
                        wheel_x_offset="${chassis_radius/sqrt(2)}" wheel_y_offset="${chassis_radius/sqrt(2)}"
                        wheel_z_offset="${wheel_offset_z}" rotation_degree="${3*pi/4}" roller_type="${roller_type}"
                        max_effort="5" max_velocity="50"
      />

      <!-- 调用全向轮宏，生成右前轮模型：
           prefix="right_front"：右前轮前缀；
           wheel_y_offset="${-chassis_radius/sqrt(2)}"：y轴偏移为负（在base_link右侧）；
           rotation_degree="${pi/4}"：旋转角度π/4=45°（右前轮方向）；
           其他参数与左前轮一致（max_effort、max_velocity等） -->
      <xacro:omni_wheel prefix="right_front" connected_to="base_link"
                        wheel_x_offset="${chassis_radius/sqrt(2)}" wheel_y_offset="${-chassis_radius/sqrt(2)}"
                        wheel_z_offset="${wheel_offset_z}" rotation_degree="${pi/4}" roller_type="${roller_type}"
                        max_effort="5" max_velocity="50"
      />

      <!-- 调用全向轮宏，生成左后轮模型：
           prefix="left_back"：左后轮前缀；
           wheel_x_offset="${-chassis_radius/sqrt(2)}"：x轴偏移为负（在base_link后方）；
           rotation_degree="${-3*pi/4}"：旋转角度-3π/4=-135°（左后轮方向）；
           其他参数一致 -->
      <xacro:omni_wheel prefix="left_back" connected_to="base_link"
                        wheel_x_offset="${-chassis_radius/sqrt(2)}" wheel_y_offset="${chassis_radius/sqrt(2)}"
                        wheel_z_offset="${wheel_offset_z}" rotation_degree="${-3*pi/4}" roller_type="${roller_type}"
                        max_effort="5" max_velocity="50"
      />

      <!-- 调用全向轮宏，生成右后轮模型：
           prefix="right_back"：右后轮前缀；
           wheel_x_offset="${-chassis_radius/sqrt(2)}"（x负方向，后方），wheel_y_offset="${-chassis_radius/sqrt(2)}"（y负方向，右侧）；
           rotation_degree="${-pi/4}"：旋转角度-π/4=-45°（右后轮方向）；
           其他参数一致 -->
      <xacro:omni_wheel prefix="right_back" connected_to="base_link"
                        wheel_x_offset="${-chassis_radius/sqrt(2)}" wheel_y_offset="${-chassis_radius/sqrt(2)}"
                        wheel_z_offset="${wheel_offset_z}" rotation_degree="${-pi/4}" roller_type="${roller_type}"
                        max_effort="5" max_velocity="50"
      />

      <!-- 调用车轮传动宏（<xacro:wheel_transmission/>），定义左前轮的传动装置（连接电机与车轮关节）：
           prefix="left_front"：传动装置名称前缀，与轮子对应；
           mechanical_reduction="19.2032"：机械减速比，与Actuators中m3508电机的reducer参数一致，
               作用：转换电机转速/扭矩到车轮关节（如电机转19.2032圈，车轮转1圈；车轮扭矩=电机扭矩*19.2032），
               是ROS控制框架（如ros_control）中电机与关节映射的关键参数 -->
      <xacro:wheel_transmission prefix="left_front" mechanical_reduction="19.2032"/>

      <!-- 右前轮传动装置：前缀对应右前轮，减速比与左前轮一致（电机型号相同） -->
      <xacro:wheel_transmission prefix="right_front" mechanical_reduction="19.2032"/>

      <!-- 左后轮传动装置：前缀对应左后轮，减速比一致 -->
      <xacro:wheel_transmission prefix="left_back" mechanical_reduction="19.2032"/>

      <!-- 右后轮传动装置：前缀对应右后轮，减速比一致 -->
      <xacro:wheel_transmission prefix="right_back" mechanical_reduction="19.2032"/>

  </xacro:macro>

</robot>
```

## omni_wheel.urdf.xacro

```xml
<!-- 机器人模型根标签：声明使用Xacro命名空间（支持参数化、宏等语法），
     name="omni_wheel"：定义该Xacro文件的核心功能是描述“全向轮”模型，便于识别 -->
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="omni_wheel">

  <!-- Xacro属性：全向轮主体的半径（单位：米），
       后续用于计算小滚轮的安装位置（确保小滚轮与地面接触），值为0.0762m（约76.2mm） -->
  <xacro:property name="wheel_radius" value="0.0762"/>
  <!-- Xacro属性：全向轮小滚轮的半径（单位：米），
       用于计算小滚轮与全向轮主体的相对位置，值为0.009m（9mm） -->
  <xacro:property name="roller_radius" value="0.009"/>

  <!-- 定义“单个小滚轮”的Xacro宏（全向轮的核心部件，负责横向移动）：
       name="roller"：宏名称，后续通过<xacro:roller/>调用；
       params="prefix suffix theta roller_type"：宏的4个输入参数，分别为：
         - prefix：名称前缀（如“left_front”，避免多车轮的小滚轮重名）；
         - suffix：小滚轮序号（区分同一全向轮上的多个小滚轮）；
         - theta：小滚轮在全向轮主体上的安装角度（弧度，确定圆周分布位置）；
         - roller_type：小滚轮类型（控制是否加载视觉/碰撞模型，如“simple”或“none”） -->
  <xacro:macro name="roller" params="prefix suffix theta roller_type">
      <!-- 条件判断：当小滚轮序号（suffix）为奇数时，设置y轴偏移量；
           joint_y_offset：小滚轮相对于全向轮主体的y轴偏移（单位：米），
           奇数序号偏移+0.009563m，用于小滚轮“交错布置”（避免相邻滚轮干涉） -->
      <xacro:if value="${suffix % 2 == 1}">
          <xacro:property name="joint_y_offset" value="0.009563"/>
      </xacro:if>
      <!-- 条件判断：当小滚轮序号（suffix）为偶数时，设置y轴偏移量；
           偶数序号偏移-0.009563m，与奇数滚轮对称，实现交错分布 -->
      <xacro:if value="${suffix % 2 == 0}">
          <xacro:property name="joint_y_offset" value="-0.009563"/>
      </xacro:if>

      <!-- 小滚轮的“连杆”定义（描述小滚轮的物理结构）：
           name="${prefix}_roller_${suffix}"：连杆名称（前缀+“roller”+序号，确保唯一） -->
      <link name="${prefix}_roller_${suffix}">
          <!-- 条件判断：当roller_type为“simple”时，加载视觉和碰撞模型（非“simple”则不加载，如仅用于动力学） -->
          <xacro:if value="${roller_type=='simple'}">
              <!-- 视觉模型（仅用于RViz/Gazebo可视化，不影响物理计算）：
                   origin：视觉模型相对于连杆原点无偏移/旋转；
                   geometry：引用外部STL模型（全向轮小滚轮的三维外观），
                   scale="0.001"：STL文件默认单位为毫米，缩放到米单位 -->
              <visual>
                  <origin xyz="0 0 0" rpy="0 0 0"/>
                  <geometry>
                      <mesh filename="package://rm_description/meshes/common/omni_roller.stl"
                            scale="0.001 0.001 0.001"/>
                  </geometry>
              </visual>
              <!-- 碰撞模型1（用于碰撞检测，如避免小滚轮与地面/障碍物碰撞）：
                   用球体近似小滚轮的碰撞形状，半径为roller_radius（小滚轮半径） -->
              <collision>
                  <geometry>
                      <sphere radius="${roller_radius}"/>
                  </geometry>
              </collision>
              <!-- 碰撞模型2（补充碰撞形状，更精准模拟小滚轮的圆柱结构）：
                   origin：绕y轴旋转90度（1.57弧度），将圆柱体立起；
                   geometry：圆柱体长度19mm（0.019m），半径8.6mm（0.0086m），匹配小滚轮实际尺寸 -->
              <collision>
                  <origin rpy="0 1.57 0" xyz="0 0 0"/>
                  <geometry>
                      <cylinder length="19e-3" radius="8.6e-3"/>
                  </geometry>
              </collision>
          </xacro:if>
          <!-- 惯性参数（用于ROS动力学计算，如速度控制、力矩分配）：
               mass：小滚轮质量（0.0058kg，约5.8克）；
               inertia：转动惯量矩阵（描述小滚轮抵抗旋转的能力，ixx/iyy/izz为各轴转动惯量，ixy/ixz/iyz为惯性积） -->
          <inertial>
              <mass value="0.0058"/>
              <inertia ixx="270.867e-9" ixy="1.547e-19" ixz="2.133e-19" iyy="291.412e-9" iyz="0.0" izz="291.412e-9"/>
          </inertial>
      </link>

      <!-- 小滚轮的“关节”定义（连接小滚轮与全向轮主体，允许小滚轮自由旋转）：
           name="${prefix}_roller_${suffix}_joint"：关节名称（确保唯一）；
           type="continuous"：关节类型为“连续旋转关节”（小滚轮无角度限制，可自由转动） -->
      <joint name="${prefix}_roller_${suffix}_joint" type="continuous">
          <!-- 关节原点（小滚轮相对于全向轮主体的位姿）：
               xyz：根据全向轮半径、小滚轮半径和安装角度计算，确保小滚轮刚好接触地面：
                 - (wheel_radius-roller_radius)：全向轮主体半径减去小滚轮半径，得到小滚轮中心到全向轮中心的距离；
                 - cos(theta-pi/2)/sin(theta-pi/2)：将安装角度偏移90度，确保小滚轮沿全向轮圆周均匀分布；
               rpy：绕y轴旋转-theta角度，使小滚轮的旋转轴与运动方向匹配 -->
          <origin
                  xyz="${(wheel_radius-roller_radius)*cos(theta-pi/2)} ${joint_y_offset} ${(wheel_radius-roller_radius)*sin(theta-pi/2)}"
                  rpy="0 ${-theta} 0"/>
          <!-- 关节旋转轴（绕x轴旋转，小滚轮滚动方向沿x轴，实现横向移动） -->
          <axis xyz="1 0 0"/>
          <!-- 关节动力学参数（影响运动阻尼和摩擦）：
               damping="0.0"：无阻尼（小滚轮转动无阻力）；
               friction="0.001"：微小静摩擦（避免小滚轮无外力时随意转动） -->
          <dynamics damping="0.0" friction="0.001"/>
          <!-- 父连杆（小滚轮的上级连杆，即全向轮主体） -->
          <parent link="${prefix}_wheel"/>
          <!-- 子连杆（当前小滚轮的连杆） -->
          <child link="${prefix}_roller_${suffix}"/>
      </joint>

      <!-- Gazebo仿真配置（仅在Gazebo中生效，定义小滚轮的物理属性）：
           reference：关联到小滚轮的连杆（${prefix}_roller_${suffix}） -->
      <gazebo reference="${prefix}_roller_${suffix}">
          <mu1 value="2000.0"/> <!-- 纵向摩擦系数（大值避免小滚轮打滑，确保横向动力传递） -->
          <mu2 value="2000.0"/> <!-- 横向摩擦系数（与mu1一致，保证各方向摩擦均匀） -->
          <kp value="1000000.0"/> <!-- 碰撞刚度（大值表示小滚轮碰撞时变形小，响应灵敏） -->
          <kd value="100.0"/> <!-- 碰撞阻尼（控制碰撞后的振动衰减速度） -->
          <material>Gazebo/Black</material> <!-- 小滚轮在Gazebo中的显示颜色（黑色） -->
      </gazebo>

  </xacro:macro>

  <!-- 定义“完整全向轮组件”的Xacro宏（包含全向轮主体+多个小滚轮，是对外调用的核心）：
       name="omni_wheel"：宏名称，用于生成左前/右前/左后/右后全向轮；
       params：宏的9个输入参数，分别为：
         - prefix：名称前缀（如“left_front”，区分不同位置的全向轮）；
         - connected_to：全向轮的父连杆（如“base_link”，即底盘主体）；
         - wheel_x_offset：全向轮相对于父连杆的x轴位置（单位：米）；
         - wheel_y_offset：全向轮相对于父连杆的y轴位置（单位：米）；
         - wheel_z_offset：全向轮相对于父连杆的z轴位置（单位：米，负值表示在底盘下方）；
         - rotation_degree：全向轮的朝向角度（弧度，确定轮的旋转方向，实现全向移动）；
         - roller_type：小滚轮类型（“simple”加载模型，“none”不加载）；
         - max_effort：全向轮关节的最大允许力矩（N·m，保护电机/机械结构）；
         - max_velocity：全向轮关节的最大允许角速度（rad/s，限制转速避免失控） -->
  <xacro:macro name="omni_wheel"
               params="prefix connected_to wheel_x_offset wheel_y_offset wheel_z_offset rotation_degree roller_type max_effort max_velocity">
      <!-- 全向轮主体的“连杆”定义（描述全向轮的核心结构）：
           name="${prefix}_wheel"：连杆名称（前缀+“wheel”，确保唯一） -->
      <link name="${prefix}_wheel">
          <!-- 视觉模型（全向轮主体的外观，RViz/Gazebo中显示）：
               geometry：引用外部STL模型（全向轮主体的三维外观），scale缩放到米单位 -->
          <visual>
              <geometry>
                  <mesh filename="package://rm_description/meshes/common/omni_wheel.stl"
                        scale="0.001 0.001 0.001"/>
              </geometry>
          </visual>
          <!-- 惯性参数（全向轮主体的动力学属性）：
               mass：全向轮主体质量（0.59kg，约590克）；
               inertia：转动惯量矩阵（描述全向轮主体抵抗旋转的能力，用于电机扭矩计算） -->
          <inertial>
              <mass value="0.59"/>
              <inertia ixx="1.416e-3" ixy="0.0" ixz="0.0" iyy="2.749e-3" iyz="0.0" izz="1.416e-3"/>
          </inertial>
      </link>

      <!-- 全向轮主体的“关节”定义（连接全向轮与底盘，由电机驱动旋转）：
           name="${prefix}_wheel_joint"：关节名称（确保唯一）；
           type="revolute"：关节类型为“旋转关节”（虽设为revolute，但上下限设为-1e9，实际等效连续旋转） -->
      <joint name="${prefix}_wheel_joint" type="revolute">
          <!-- 关节旋转轴（绕y轴旋转，全向轮主体的驱动方向，实现前进/后退） -->
          <axis xyz="0 1 0"/>
          <!-- 关节原点（全向轮相对于底盘的位姿）：
               xyz：全向轮在x/y/z轴的位置（由输入参数确定，确保四个全向轮对称分布）；
               rpy：绕z轴旋转rotation_degree角度，确定全向轮的朝向（如左前轮135度，实现全向移动） -->
          <origin xyz="${wheel_x_offset} ${wheel_y_offset} ${wheel_offset_z}" rpy="0 0 ${rotation_degree}"/>
          <!-- 关节限制（注释说明：type为continuous时此限制无效，此处仅为兼容配置）：
               effort="${max_effort}"：最大力矩（与joint_limits一致，保护硬件）；
               velocity="${max_velocity}"：最大角速度（与joint_limits一致，限制转速）；
               lower="-1e9"/upper="1e9"：上下限设为极大值，等效连续旋转 -->
          <limit effort="${max_effort}" velocity="${max_velocity}" lower="-1e9" upper="1e9"/>
          <!-- 关节动力学参数：
               damping="0.0"：无阻尼（减少驱动阻力）；
               friction="0.05"：静摩擦（避免全向轮无动力时滑动） -->
          <dynamics damping="0.0" friction="0.05"/>
          <!-- 父连杆（全向轮的上级连杆，即底盘base_link） -->
          <parent link="${connected_to}"/>
          <!-- 子连杆（全向轮主体的连杆） -->
          <child link="${prefix}_wheel"/>
      </joint>

      <!-- 条件判断：当roller_type不为“none”时，生成26个小滚轮（全向轮需多个小滚轮实现横向移动）；
           若为“none”，则不加载小滚轮（如仅用于简化仿真） -->
      <xacro:unless value="${roller_type=='none'}">
          <!-- 循环调用roller宏，生成26个小滚轮，序号0-25，安装角度间隔pi/13（约13.8度）：
               theta="${n*pi/13}"：每个小滚轮的安装角度均匀分布在360度圆周上，确保横向移动平稳；
               26个滚轮：360度/(pi/13弧度)≈26，实现全圆周覆盖 -->
          <xacro:roller prefix="${prefix}" suffix="0" theta="${0*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="1" theta="${1*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="2" theta="${2*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="3" theta="${3*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="4" theta="${4*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="5" theta="${5*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="6" theta="${6*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="7" theta="${7*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="8" theta="${8*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="9" theta="${9*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="10" theta="${10*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="11" theta="${11*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="12" theta="${12*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="13" theta="${13*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="14" theta="${14*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="15" theta="${15*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="16" theta="${16*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="17" theta="${17*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="18" theta="${18*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="19" theta="${19*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="20" theta="${20*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="21" theta="${21*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="22" theta="${22*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="23" theta="${23*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="24" theta="${24*pi/13}" roller_type="${roller_type}"/>
          <xacro:roller prefix="${prefix}" suffix="25" theta="${25*pi/13}" roller_type="${roller_type}"/>
      </xacro:unless>

  </xacro:macro>

  <!-- 定义“车轮传动装置”的Xacro宏（连接电机与全向轮关节，实现动力转换，ROS Control核心配置）：
       name="wheel_transmission"：宏名称，用于为每个全向轮配置传动；
       params="prefix mechanical_reduction"：宏的2个输入参数：
         - prefix：名称前缀（与全向轮前缀一致，确保传动与车轮对应）；
         - mechanical_reduction：机械减速比（电机转速/扭矩转换为车轮转速/扭矩的比例） -->
  <xacro:macro name="wheel_transmission" params="prefix mechanical_reduction">
      <!-- 传动装置定义（ROS Control标准标签，描述电机与关节的动力传递关系）：
           name="${prefix}_wheel_trans"：传动名称（确保唯一） -->
      <transmission name="${prefix}_wheel_trans">
          <!-- 传动类型：SimpleTransmission（简单线性传动，无复杂齿轮结构，扭矩/转速按减速比线性转换） -->
          <type>transmission_interface/SimpleTransmission</type>
          <!-- 执行器（电机）配置：
               name="${prefix}_wheel_motor"：电机名称（与全向轮对应）；
               hardwareInterface：硬件接口类型（EffortJointInterface，即力矩控制接口，电机输出力矩）；
               mechanicalReduction：机械减速比（如19.2032，电机转19.2032圈，车轮转1圈；车轮扭矩=电机扭矩×19.2032） -->
          <actuator name="${prefix}_wheel_motor">
              <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
              <mechanicalReduction>${mechanical_reduction}</mechanicalReduction>
          </actuator>
          <!-- 关联的车轮关节：
               name="${prefix}_wheel_joint"：与全向轮的关节对应；
               hardwareInterface：关节的硬件接口（与电机一致，确保力矩信号传递） -->
          <joint name="${prefix}_wheel_joint">
              <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
          </joint>
      </transmission>
  </xacro:macro>

</robot>
```
